---
title: 'Tcl Cheat Sheet'
date: 2022-08-30 17:51:47
tags: [cheat-sheet,tcl]
published: true
hideInList: false
feature: 
isTop: false
---
- 基础语法

```python
puts "Hello World"#输出
set x [expr 1 == 2 ? 1 : 2]#设置变量；三元运算符
[exec ls]#调用子进程

#if
if { $x < 2} { ... }
elseif { $x == 1 } { ... }

#while
while { $x < 2 } {
	incr x
}

#for
for { set i 0 } { $i < 5 } { incr i } { ... }

#switch
switch $x {
	1 { ... }
	2 { ... }
	default { ... }
}
```

- 字符串

```python
set s1 "_Hello_World_"
set s2 "_"

[string length $s1]
[string index $s1 0]
[string range $s1 1 end]
append s1 "!"
[string repeat $s1 5]#"_Hello_World_"*5

[string toupper $s1]
[string tolower $s1]

[string compare $s1 $s2]
[string equal $s1 $s2]

[string first $s2 $s1]#s1中第一个匹配s2索引
[string last $s2 $s1]#s1中最后一次匹配s2索引

[string trim $s1 $s2]#->Hello_World
[string trimright $s1 $s2]#->_Hello_World
[string trimleft $s1 $s2]#->Hello_World_

set s1 "abc@163.com"
set s2 "*@*.com"
[string match $s2 $s1]

[format "%s %x %f" "tcl" 40 43.5]
scan {planet1 0.330 planet2 4.87} {planet1 %g planet2 %g}#-> 0.330 4.87 
```

- 列表

```python
#初始化
set colors {red green blue}
set colors [split "red_green_blue" _]
set colors [list red green blue]

[lindex $colors 1]
[lrange $colors 0 2]
[llength $colors]
lappend colors "orange"#末尾添加元素
lset colors 3 purple#设置第n个元素
[linsert $colors 3 black white]
[lreplace $colors 0 1 black white]
[lsearch $colors black]
concat $colors {black {white purple}}#->$colors black {white purple}
[join $colors /]#列表元素以特定分隔符组合为字符串
[lsort $colors]
foreach item $colors { ... }#遍历
```

- 字典

```python
#初始化
dict set colors c1 red
set colors [dict create c1 "black" c2 "white"]

[dict size $colors]
[dict keys $colors]#所有key组合成的列表
[dict values $colors]#所有value组合成的列表
[dict exists $colors c1]
#遍历
foreach item [dict keys $colors] {
	set value [dict get $colors item]
}
dict for {key value} $colors {
	puts "$key : $value"
}
```

- IO

```python
#写入文件
set fp [open "input.txt" w+]
puts $fp "Hello world."
close $fp
#读取文件
set fp [open "input.txt" r]
set file_data [read $fp]
close $fp

set fp [open "input.txt" r]
while {% [gets $fp data] >= 0 %} {%
  puts $data
%}
close $fp
#文件名相关操作
[file join C:/ {Program Files} Tcl tclsh.exe]#->C:/Program Files/Tcl/tclsh.exe
[file split x/y/z]#->x y z
[file dirname /a/b/main.c]#->/a/b
[file extension src/main.c]#->.c
[file rootname src/main.c]#->src/main
[file tail /a/b/c.txt]#->c.txt
#查找文件
glob -nocomplain {{src,backup}/*.[ch]}]#-nocomplain:跳过搜索结果为空时报错;{{src,backup}/*.[ch]}:正则匹配搜索文件
[glob -directory ./ -types f -tails *]#-directory:指定搜索文件夹;-types:指定搜索对象类型
#文件相关操作
file mkdir foo
file delete a.txt b.txt *.tmp
file delete {*}[glob *]
file copy a.txt b.txt#a.txt复制到b.txt
file rename b.txt c.txt#b.txt重命名为c.txt
```

- 正则匹配

```python
#匹配
regexp {([a-z]*).([a-z]*)} "Tcl Command" sm sm1 sm2#sm:full match;sm1:sub match 1;sm2:sub match 2
regexp -nocase -start 4 -line -- {([a-z]*).([a-z]*)} "Tcl\nCommand" sm sm1 sm2#-nocase：忽视大小写;-start:指定匹配开始位置;-line:跨行匹配
#替换
regsub there "They lives there lives" their s#->s:They lives their lives
regsub -all a ababa zz s#->s:zzbzzbzz
regsub -all -- (a+)(ba*) aabaabxab {z\2} s#->s:zbaabxzb
```

- 数学运算

```python
namespace import ::tcl::mathfunc::*

[rand]
set x -1.2
set y 2
[abs $x]
[ceil $x]#向上取整
[floor $x]#向下取整
[fmod $x $y]#%
[int $x]
[pow $x $y]
[round $x]
[sqrt $y]
[max $x $y]
[min $x $y]
```

- 时间

```python
set curr_tm [clock seconds]
[clock format $curr_tm -format %H:%M:%S]#->15:34:01
[clock format $curr_tm -format %D]#08/29/2022

set date "Jun 15, 2014"
[clock scan $date -format {%b %d, %Y}]#->1402761600

after 500#休眠n毫秒
```

- 函数

```python
proc add {a b} {
	return [expr $a + $b]
}

[add 10 30]

#错误与异常
catch {set fp [open no.txt]} errmsg
puts "ErrorMsg: $errmsg"

proc div {a b} {
  if {$b == 0} {
    error "Error generated by error" "Info String for error" 401
  } else {
    return [expr $a / $b]
  }
}

if {[catch {puts "Result = [div 10 0]"} errmsg]} {
  puts "ErrorMsg: $errmsg"
  puts "ErrorCode: $errorCode"
  puts "ErrorInfo:\n$errorInfo\n"
}
```
