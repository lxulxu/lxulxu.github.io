<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><style type=text/css>body{font-family:monospace}</style><title>DFX中的关键概念与规则</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel=stylesheet><link rel=stylesheet href=/css/style.css></head><body><header>===================<br>== <a href=https://lxulxu.github.io/>lxulxu's blog</a> ==<br>===================<div style=float:right>Hello there</div><br><p><nav><a href=/><b>Start</b></a>.
<a href=/posts/><b>Posts</b></a>.
<a href=/categories/><b>Categories</b></a>.
<a href=/tags/><b>Tags</b></a>.
<a href=/about/><b>About</b></a>.</nav></p></header><main><article><h1>DFX中的关键概念与规则</h1><b><time>15.11.2024 00:00</time></b>
<a href=/tags/xilinx>xilinx</a>
<a href=/tags/dfx>DFX</a><div><h2 id=1-基础概念与术语>1. 基础概念与术语</h2><h3 id=11-动态重配置的定义>1.1 动态重配置的定义</h3><p>​ Dynamic Function eXchange(DFX，也称为动态部分重配置)是一种在FPGA运行时动态修改其部分功能区域的技术。DFX可以在FPGA继续运行时，让用户更改芯片预定义区域的功能，而不影响其他区域的正常运行。相比传统的全局配置方式，DFX具有以下优势：</p><ul><li>节省硬件成本：可以通过时分复用的方式在同一个区域切换不同功能</li><li>支持实时更新：无需停止系统运行即可更新部分功能</li><li>提升系统灵活性：可以根据需要动态调整功能</li><li>减少配置时间：部分配置比完整配置速度更快</li></ul><p>​ FPGA 设计中的逻辑分为两种不同类型：可重配置逻辑和静态逻辑。静态逻辑在运行期间保持正常工作，不受加载部分比特流的影响。可重配置逻辑则会被部分比特流的内容替换。</p><p><figure><img src=../../assets/images/Y2024Q4/1.png alt="DFX Basic Concept"></figure></p><p>​ 如上图所示，通过下载任一部分比特流文件(A1.bit、A2.bit、A3.bit 或A4.bit)即可修改重配置块 A 中实现的功能。标记为"FPGA"的区域表示静态逻辑，标记为"重配置块 A"的区域表示可重配置逻辑。</p><h3 id=12-核心术语解析>1.2 核心术语解析</h3><h4 id=121-重配置分区rp-reconfigurable-partition>1.2.1 重配置分区(RP, Reconfigurable Partition)</h4><p>重配置分区是DFX设计中可以进行动态重新配置的物理区域。它具有以下关键特征：</p><ul><li><p>逻辑特征</p><ul><li>是HDL设计中的一个模块实例</li><li>必须具有稳定的接口定义</li><li>可以包含多个子模块</li></ul></li><li><p>物理特征</p><ul><li>由一个或多个Pblock定义的器件区域</li><li>区域边界必须遵循特定规则</li><li>资源独占，不能与其他RP重叠</li></ul></li></ul><h4 id=122-重配置模块rm-reconfigurable-module>1.2.2 重配置模块(RM, Reconfigurable Module)</h4><p>重配置模块是可以加载到重配置分区(RP)中的具体功能实现。它具有以下特点：</p><ul><li><p>实现要求</p><ul><li>必须与RP定义的接口完全匹配</li><li>逻辑必须能够完全放入指定的RP区域</li><li>每个RM都需要独立的部分比特流文件</li></ul></li><li><p>兼容性要求</p><ul><li>同一个RP的所有RM之间必须接口兼容</li><li>必须遵循相同的时序和资源约束</li></ul></li></ul><h4 id=123-静态逻辑与动态逻辑>1.2.3 静态逻辑与动态逻辑</h4><p>FPGA的逻辑分为两类：</p><ul><li><p>静态逻辑：初始配置后保持不变的部分</p><ul><li>在重配置过程中持续运行</li><li>包含全局资源（如时钟、配置逻辑等）</li><li>管理重配置过程和接口</li></ul></li><li><p>动态逻辑：运行时可重新配置的部分</p><ul><li>位于RP内部</li><li>可以被不同RM替换</li><li>重配置过程中状态不可预测</li></ul></li></ul><h4 id=124-分区管脚partpin>1.2.4 分区管脚(PartPin)</h4><p>分区管脚是RP与静态逻辑之间的物理接口点：</p><ul><li><p>基本特征</p><ul><li>每个管脚都有一个分区管脚(PartPin)</li><li>由工具自动布局在RP Pblock范围内</li><li>必须是单向的，不支持双向端口</li><li>在所有RM配置中保持固定位置</li><li>影响布线资源使用和时序性能</li></ul></li><li><p>实现控制</p><ul><li>通常自动布局即可满足需求</li><li>对于高拥塞或时序关键接口信号，可通过HD.PARTPIN_RANGE约束指导布局</li><li>可通过以下语法设置PartPin范围:<div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tcl data-lang=tcl><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>set_property HD.PARTPIN_RANGE <span style=color:#fe8019>{</span>SLICE_Xx0Yx0<span style=color:#fe8019>:</span>SLICE_Xx1Yy1<span style=color:#fe8019>}</span> <span style=color:#fe8019>[</span>get_pins <span style=color:#fe8019>&lt;</span>rp_cell_name<span style=color:#fe8019>&gt;/*</span><span style=color:#fe8019>]</span>
</span></span></code></pre></div></li><li>对于负载较少或要求较低的时钟，可将全局时钟降级至区域时钟来提升布局规划灵活性</li></ul></li></ul><h4 id=125-配置帧configuration-frame>1.2.5 配置帧(Configuration Frame)</h4><p>配置帧是FPGA配置的基本单位：</p><ul><li><p>7系列器件</p><ul><li>配置帧高度与时钟区域对齐</li><li>一个帧包含该区域内所有可编程资源</li><li>帧边界对资源划分有重要影响</li></ul></li><li><p>UltraScale/UltraScale+器件</p><ul><li>基于可编程单元(PU)进行重配置</li><li>支持更细粒度的重配置</li></ul></li><li><p>通用限制</p><ul><li>每个物理可重配置帧仅限包含一个RP</li><li>帧内可以包含静态逻辑，但重配置时会被改写</li><li>需要考虑帧边界进行资源规划</li></ul></li></ul><h4 id=126-自下而上综合bottom-up-synthesis>1.2.6 自下而上综合(Bottom-up Synthesis)</h4><p>自下而上综合是DFX设计的推荐实施方法，实施要点如下：</p><ul><li>独立综合每个RM和静态逻辑</li><li>确保接口定义一致性</li><li>维护公共时序约束</li><li>管理资源分配与优化边界</li><li>验证静态逻辑与RM的接口兼容性</li><li>使用增量编译提高效率</li></ul><h3 id=13-布局规划相关概念>1.3 布局规划相关概念</h3><h4 id=131-pblockphysical-block>1.3.1 Pblock(Physical Block)</h4><p>Pblock是DFX中的物理约束单元。</p><table><thead><tr><th>属性类别</th><th>属性名</th><th>功能描述</th></tr></thead><tbody><tr><td>基本属性</td><td>区域定义</td><td>由一个或多个矩形区域组成</td></tr><tr><td></td><td>资源控制</td><td>可指定包含或排除特定类型资源</td></tr><tr><td>DFX相关</td><td>HD.RECONFIGURABLE</td><td>标记可重配置区域</td></tr><tr><td></td><td>SNAPPING_MODE</td><td>控制边界对齐<br>7系列:<br>- OFF: 默认值，不执行调整<br>- ON: 修复所有不间断连续违例<br>- ROUTING: 特殊例外处理<br>UltraScale系列:<br>- 默认开启<br>- 自动确保PU对齐</td></tr><tr><td></td><td>CONTAIN_ROUTING</td><td>控制布线约束</td></tr></tbody></table><h4 id=132-可编程单元pu>1.3.2 可编程单元(PU)</h4><p>UltraScale/UltraScale+架构中的PU布局规则：</p><ul><li><p>PU基本要求</p><ul><li>每种PU类型有特定的相邻CLB要求(5-120个不等)</li><li>PU内所有资源必须完整包含在分区内</li><li>多个PU可共享布线资源</li></ul></li><li><p>布局考量</p><ul><li>需要从必需站点向外构建基础PU</li><li>可使用特定工具命令识别PU:<div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tcl data-lang=tcl><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>get_sites <span style=color:#fe8019>-</span>of_objects <span style=color:#fe8019>[</span>get_tiles <span style=color:#fe8019>-</span>pu <span style=color:#fe8019>-</span>of_objects <span style=color:#fe8019>[</span>get_tiles <span style=color:#fe8019>-</span>of_objects <span style=color:#fe8019>[</span>get_sites <span style=color:#fe8019>&lt;</span>site<span style=color:#fe8019>&gt;</span><span style=color:#fe8019>]]]</span>
</span></span></code></pre></div></li><li>布线资源PU规则比资源PU规则更严格</li><li>建议使工具命令显示PU边界帮助规划</li></ul></li></ul><p>例如，可通过这种方式找到并排 SLICE 站点的可编程单元,这样即可返回基本 PU，其中显示了 SLICE 内的成对 CLB，以及 CLB 之间的共享互连。</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tcl data-lang=tcl><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>resize_pblock pblock_rp1 <span style=color:#fe8019>-</span>add <span style=color:#fe8019>[</span>get_sites <span style=color:#fe8019>-</span>of_objects <span style=color:#fe8019>[</span>get_tiles <span style=color:#fe8019>-</span>pu <span style=color:#fe8019>-</span>of_objects <span style=color:#fe8019>[</span>get_tiles <span style=color:#fe8019>-</span>of_objects <span style=color:#fe8019>[</span>get_sites SLICE_X36Y259<span style=color:#fe8019>]]]]</span>
</span></span></code></pre></div><p><figure><img src=../../assets/images/Y2024Q4/2.png alt="屏幕截图 2024-11-15 104006"></figure></p><h4 id=133-布线占板面积routing-footprint>1.3.3 布线占板面积(Routing Footprint)</h4><p>布线占板面积定义RP的布线资源范围：</p><ul><li>UltraScale/UltraScale+特性<ul><li>支持扩展布线区域</li><li>可扩展至Pblock边界外</li><li>影响部分比特流大小</li></ul></li><li>布线控制<ul><li>可通过参数控制扩展</li><li>需权衡布线灵活性和比特流大小</li><li>建议使用工具命令检查布线占板区域</li></ul></li></ul><h1 id=2-器件架构相关规则>2. 器件架构相关规则</h1><p>FPGA动态重配置架构规则总表</p><table><thead><tr><th>规则类别</th><th>具体规则项</th><th>7系列器件</th><th>UltraScale/UltraScale+器件</th><th>规则重要性</th></tr></thead><tbody><tr><td><strong>A. 资源使用规则</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>A1. 基础逻辑资源</td><td>CLB资源</td><td>✓ LUT, FF, SRL<br>✓ 分布式RAM/ROM</td><td>✓ 同7系列<br>✓ 资源配置更灵活</td><td>必需</td></tr><tr><td></td><td>存储资源</td><td>✓ RAMB18E1/36E1<br>✓ FIFO18E1/36E1<br>✓ BRAM宏</td><td>✓ RAMB18E2/36E2<br>✓ FIFO18E2/36E2<br>✓ UltraRAM(URAM288)</td><td>必需</td></tr><tr><td></td><td>DSP资源</td><td>✓ DSP48E1及衍生宏</td><td>✓ DSP48E2</td><td>必需</td></tr><tr><td><strong>A2. 时钟资源</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>A2.1 时钟容量</td><td>数量限制</td><td>⚠️ 每时钟区域最多12个时钟轴<br>⚠️ 静态和动态共享此限制</td><td>✓ 每时钟区域24个时钟轴<br>✓ 更灵活的分配方式</td><td>强制</td></tr><tr><td></td><td>布线资源</td><td>⚠️ 时钟轴预布线占用固定资源<br>⚠️ 影响静态逻辑可用资源</td><td>✓ 时钟资源更充足<br>✓ 预布线影响较小</td><td>关键</td></tr><tr><td>A2.2 时钟结构</td><td>放置规则</td><td>✗ 时钟资源必须在静态区域<br>⚠️ 需考虑全局布线资源</td><td>✓ 允许在RP内放置时钟资源<br>⚠️ 需遵循PU规则</td><td>强制</td></tr><tr><td></td><td>跨区域规则</td><td>⚠️ 垂直跨越需特别处理<br>⚠️ 需考虑时钟骨干线资源</td><td>✓ 支持更灵活的跨域分布<br>⚠️ 注意时钟域划分</td><td>重要</td></tr><tr><td>A2.3 时钟控制</td><td>使能控制</td><td>⚠️ 必须在静态区域控制<br>⚠️ 重配置期间保持稳定</td><td>✓ 支持动态区域控制<br>⚠️ 需要正确的去耦设计</td><td>关键</td></tr><tr><td></td><td>复位控制</td><td>⚠️ 需要特殊的复位策略<br>⚠️ BUFGCTRL需注意</td><td>✓ 自动处理复位<br>✓ 更简单的控制逻辑</td><td>重要</td></tr><tr><td>A2.4 时钟特性</td><td>预布线要求</td><td>⚠️ 所有驱动RP的时钟需预布线<br>⚠️ 需考虑最坏情况资源</td><td>⚠️ 同样需要预布线<br>✓ 资源限制更少</td><td>强制</td></tr><tr><td></td><td>动态修改</td><td>✗ 不支持动态时钟修改</td><td>✓ 支持MMCM/PLL动态修改<br>⚠️ 需要正确的控制时序</td><td>重要</td></tr><tr><td><strong>A3. 接口资源</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>A3.1 I/O标准</td><td>一致性要求</td><td>⚠️ I/O标准必须保持一致<br>⚠️ 必须在静态区域定义</td><td>⚠️ 方向和标准需保持一致<br>✓ 可以动态调整参数</td><td>强制</td></tr><tr><td></td><td>可修改特性</td><td>✗ 不支持动态修改</td><td>✓ 支持修改驱动强度<br>✓ 支持修改阻抗设置<br>✓ 支持修改斜率控制<br>✓ 支持修改ODT设置</td><td>重要</td></tr><tr><td>A3.2 I/O配置</td><td>Bank管理</td><td>⚠️ Bank必须在静态区域<br>⚠️ 不支持动态修改</td><td>✓ 支持整个Bank重配置<br>⚠️ 重配置影响整个Bank</td><td>强制</td></tr><tr><td></td><td>重配置控制</td><td>✗ 不支持I/O重配置</td><td>✓ 支持重配置期间保持状态<br>⚠️ 使用专用全局三态信号</td><td>关键</td></tr><tr><td>A3.3 DCI规则</td><td>Bank级联</td><td>⚠️ 需在静态区域管理</td><td>⚠️ 成员bank不可重复<br>⚠️ 必须完全包含在RP内<br>⚠️ RM间保持一致性</td><td>强制</td></tr><tr><td></td><td>校准控制</td><td>✗ 不支持动态校准</td><td>✓ 重配置后自动校准<br>✓ 无需DCIRESET</td><td>重要</td></tr><tr><td>A3.4 接口时序</td><td>输入接口</td><td>⚠️ 建议在静态侧寄存<br>⚠️ 需处理建立/保持时间</td><td>⚠️ 同样建议寄存<br>✓ 支持更灵活的时序控制</td><td>建议</td></tr><tr><td></td><td>输出接口</td><td>⚠️ 建议使用去耦逻辑<br>⚠️ 重配置期间需稳定</td><td>⚠️ 同样需要去耦<br>✓ 支持更多去耦选项</td><td>建议</td></tr><tr><td>A3.5 特殊接口</td><td>ISERDES/OSERDES</td><td>✗ 必须在静态区域</td><td>✓ 可以在RP内使用<br>⚠️ 需要正确的初始化</td><td>重要</td></tr><tr><td></td><td>IDELAYCTRL</td><td>✗ 必须在静态区域</td><td>✓ 可以在RP内使用<br>⚠️ 需要考虑校准时间</td><td>重要</td></tr><tr><td>A4. 特殊资源</td><td>配置逻辑</td><td>✗ 配置原语需在静态区域</td><td>✗ 除DNA_PORT外都需在静态区域</td><td>强制</td></tr><tr><td></td><td>PCIe资源</td><td>✓ PCIe IP核</td><td>✓ PCIe/CMAC/ILKN</td><td>可选</td></tr><tr><td><strong>B. 物理规划规则</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>B1. Pblock规则</td><td>高度对齐</td><td>⚠️ 使用RESET_AFTER_RECONFIG时需对齐时钟区域</td><td>✓ 不强制对齐<br>✓ 自动GSR</td><td>重要</td></tr><tr><td></td><td>宽度对齐</td><td>⚠️ 必须在资源列间划分<br>⚠️ 不能在INT-INT间划分</td><td>✓ 基于PU对齐<br>✓ 更灵活的划分</td><td>重要</td></tr><tr><td></td><td>形状限制</td><td>⚠️ 严格的连续性要求<br>⚠️ 不建议不规则形状</td><td>✓ 支持较灵活的形状<br>⚠️ 仍建议规则形状</td><td>建议</td></tr><tr><td>B2. 最小单元</td><td>资源粒度</td><td>基于配置帧</td><td>基于PU<br>CLB PU：2个相邻CLB<br>BRAM PU：1个RAMBFIFO36, 2个RAMB18，5个相邻CLB<br>URAM PU：1个URAM，30个相邻CLB(每侧15个)<br>DSP PU：1个DSP拼块(含2个DSP站点)，5个相邻CLBz<br>&mldr;</td><td>强制</td></tr><tr><td>B3. 布线规则</td><td>布线限制</td><td>⚠️ 严格限制在Pblock内</td><td>✓ 支持布线扩展<br>✓ 可控制扩展范围</td><td>重要</td></tr><tr><td></td><td>接口布线</td><td>⚠️ 需要在边界设置PartPin</td><td>✓ 支持更灵活的布线<br>✓ 自动优化布线资源</td><td>重要</td></tr><tr><td><strong>C. 特殊功能规则</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>C1. 复位控制</td><td>初始化</td><td>✓ 可选RESET_AFTER_RECONFIG</td><td>✓ 自动GSR控制</td><td>重要</td></tr><tr><td>C2. 时钟控制</td><td>时钟数量</td><td>⚠️ 每区域最多12个时钟</td><td>✓ 每区域支持24个时钟</td><td>关键</td></tr><tr><td></td><td>预布线</td><td>⚠️ 需预布线至所有相关区域</td><td>✓ 同样需要，但资源更充足</td><td>关键</td></tr><tr><td>C3. DCI控制</td><td>Bank级联</td><td>-</td><td>⚠️ 不可重复使用bank<br>⚠️ 需在同一RP内</td><td>必需</td></tr></tbody></table><ul><li>✓ 支持/允许</li><li>✗ 不支持/禁止</li><li>⚠️ 特殊规则/限制</li></ul></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/posts/dfx_key_concepts_and_rules/>DFX中的关键概念与规则</a></li><li><a href=/posts/y2024q4-media-summary/>Y2024Q4 影视音总结</a></li><li><a href=/posts/tcl_c_api_usage_1/>Tcl C API 概览(一)</a></li><li><a href=/posts/push_back_emplace_back/>C++中的push_back与emplace_back</a></li><li><a href=/posts/y2024q3-media-summary/>Y2024Q3 影视音总结</a></li></ul></div></div></aside><footer><p>&copy; 2024 <a href=https://lxulxu.github.io/><b>lxulxu's blog</b></a>.
<a href=https://github.com/lxulxu><b>Github</b></a>.
<a href=https://space.bilibili.com/7739434><b>Bilibili</b></a>.</p></footer></body></html>