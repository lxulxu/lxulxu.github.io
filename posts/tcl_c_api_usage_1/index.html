<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><style type=text/css>body{font-family:monospace}</style><title>Tcl C API 概览(一)</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel=stylesheet><link rel=stylesheet href=/css/style.css></head><body><header>===================<br>== <a href=https://lxulxu.github.io/>lxulxu's blog</a> ==<br>===================<div style=float:right>Hello there</div><br><p><nav><a href=/><b>Start</b></a>.
<a href=/posts/><b>Posts</b></a>.
<a href=/categories/><b>Categories</b></a>.
<a href=/tags/><b>Tags</b></a>.
<a href=/about/><b>About</b></a>.</nav></p></header><main><article><h1>Tcl C API 概览(一)</h1><b><time>20.09.2024 00:00</time></b>
<a href=/tags/tcl>tcl</a><div><h2 id=解释器管理>解释器管理</h2><p>解释器是Tcl的核心概念。这部分API用于创建、删除和管理Tcl解释器。</p><h3 id=tcl_createinterp>Tcl_CreateInterp</h3><p><strong>功能</strong>: 创建一个新的Tcl解释器</p><p><strong>语法</strong>: <code>Tcl_Interp *Tcl_CreateInterp(void)</code></p><p><strong>返回值</strong>: 新创建的解释器的指针</p><p><strong>说明</strong>:</p><ul><li>创建一个新的Tcl解释器实例</li><li>必须使用Tcl_DeleteInterp释放</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Interp <span style=color:#fe8019>*</span>interp <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_CreateInterp</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (interp <span style=color:#fe8019>==</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#928374;font-style:italic>// 处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_deleteinterp>Tcl_DeleteInterp</h3><p><strong>功能</strong>: 删除Tcl解释器</p><p><strong>语法</strong>: <code>void Tcl_DeleteInterp(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 要删除的解释器</li></ul><p><strong>说明</strong>:</p><ul><li>释放与解释器相关的所有资源</li><li>调用所有已注册的退出处理程序</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_DeleteInterp</span>(interp);
</span></span></code></pre></div><h3 id=tcl_interpdeleted>Tcl_InterpDeleted</h3><p><strong>功能</strong>: 检查解释器是否已被删除</p><p><strong>语法</strong>: <code>int Tcl_InterpDeleted(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 要检查的解释器</li></ul><p><strong>返回值</strong>: 如果解释器已被删除返回1，否则返回0</p><p><strong>说明</strong>:</p><ul><li>用于检查解释器的状态，特别是在异步操作中</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_InterpDeleted</span>(interp)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#928374;font-style:italic>// 解释器已被删除，进行相应处理
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_preserve>Tcl_Preserve</h3><p><strong>功能</strong>: 增加对象的引用计数</p><p><strong>语法</strong>: <code>void Tcl_Preserve(ClientData data)</code></p><p><strong>参数</strong>:</p><ul><li><code>data</code>: 要增加引用计数的对象</li></ul><p><strong>说明</strong>:</p><ul><li><p>用于防止对象被过早删除</p></li><li><p>必须与Tcl_Release配对使用</p></li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_Preserve</span>(interp);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#928374;font-style:italic>// 使用interp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#928374;font-style:italic></span><span style=color:#fabd2f>Tcl_Release</span>(interp);
</span></span></code></pre></div><h3 id=tcl_release>Tcl_Release</h3><p><strong>功能</strong>: 减少对象的引用计数</p><p><strong>语法</strong>: <code>void Tcl_Release(ClientData data)</code></p><p><strong>参数</strong>:
* <code>data</code>: 要减少引用计数的对象</p><p><strong>说明</strong>:</p><ul><li>与Tcl_Preserve配对使用</li><li>当引用计数降为0时，对象可能会被删除</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_Release</span>(interp);
</span></span></code></pre></div><h3 id=tcl_getmaster>Tcl_GetMaster</h3><p><strong>功能</strong>: 获取从解释器的主解释器</p><p><strong>语法</strong>: <code>Tcl_Interp *Tcl_GetMaster(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 从解释器</li></ul><p><strong>返回值</strong>: 主解释器的指针，如果没有则返回NULL</p><p><strong>说明</strong>:</p><ul><li>用于获取从解释器的主解释器</li><li>主要用于安全和限制操作</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Interp <span style=color:#fe8019>*</span>masterInterp <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetMaster</span>(slaveInterp);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (masterInterp <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#928374;font-style:italic>// 使用主解释器
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_getslave>Tcl_GetSlave</h3><p><strong>功能</strong>: 获取主解释器的指定从解释器</p><p><strong>语法</strong>: <code>Tcl_Interp *Tcl_GetSlave(Tcl_Interp *interp, const char *slaveName)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 主解释器</li><li><code>slaveName</code>: 从解释器的名称</li></ul><p><strong>返回值</strong>: 从解释器的指针，如果不存在则返回NULL</p><p><strong>说明</strong>:</p><ul><li>用于获取指定名称的从解释器</li><li>主要用于管理多个解释器的场景</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Interp <span style=color:#fe8019>*</span>slaveInterp <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetSlave</span>(masterInterp, <span style=color:#b8bb26>&#34;slave1&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (slaveInterp <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#928374;font-style:italic>// 使用从解释器
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_createslave>Tcl_CreateSlave</h3><p><strong>功能</strong>: 创建一个新的从解释器</p><p><strong>语法</strong>: <code>Tcl_Interp *Tcl_CreateSlave(Tcl_Interp *interp, const char *slaveName, int isSafe)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 主解释器</li><li><code>slaveName</code>: 新从解释器的名称</li><li><code>isSafe</code>: 是否创建安全解释器（0为否，1为是）</li></ul><p><strong>返回值</strong>: 新创建的从解释器的指针</p><p><strong>说明</strong>:</p><ul><li>创建一个新的从解释器，可以是安全或非安全的</li><li>安全解释器有限制，不能执行某些潜在危险的操作</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Interp <span style=color:#fe8019>*</span>safeSlaveInterp <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_CreateSlave</span>(masterInterp, <span style=color:#b8bb26>&#34;safeSlave&#34;</span>, <span style=color:#d3869b>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (safeSlaveInterp <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#928374;font-style:italic>// 使用安全从解释器
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_makesafe>Tcl_MakeSafe</h3><p><strong>功能</strong>: 将解释器转换为安全模式</p><p><strong>语法</strong>: <code>int Tcl_MakeSafe(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 要转换的解释器</li></ul><p><strong>返回值</strong>: 成功返回TCL_OK，失败返回TCL_ERROR</p><p><strong>说明</strong>:</p><ul><li>将现有解释器转换为安全模式</li><li>移除所有可能不安全的命令和功能</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_MakeSafe</span>(interp) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#928374;font-style:italic>// 解释器现在处于安全模式
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#928374;font-style:italic></span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic>// 转换失败，处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_limitcheck>Tcl_LimitCheck</h3><p><strong>功能</strong>: 检查解释器是否超过了资源限制</p><p><strong>语法</strong>: <code>int Tcl_LimitCheck(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 要检查的解释器</li></ul><p><strong>返回值</strong>: 如果超过限制返回1，否则返回0</p><p><strong>说明</strong>:</p><ul><li>用于检查解释器是否超过了预设的资源限制</li><li>主要用于防止脚本无限执行或消耗过多资源</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_LimitCheck</span>(interp)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#928374;font-style:italic>// 解释器超过了资源限制，采取相应措施
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_setrecursionlimit>Tcl_SetRecursionLimit</h3><p><strong>功能</strong>: 设置解释器的递归限制</p><p><strong>语法</strong>: <code>int Tcl_SetRecursionLimit(Tcl_Interp *interp, int depth)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 要设置的解释器</li><li><code>depth</code>: 新的递归深度限制</li></ul><p><strong>返回值</strong>: 旧的递归深度限制</p><p><strong>说明</strong>:</p><ul><li>用于防止过深的递归导致栈溢出</li><li>默认限制通常为1000</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> oldLimit <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_SetRecursionLimit</span>(interp, <span style=color:#d3869b>500</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Old recursion limit was: %d</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, oldLimit);
</span></span></code></pre></div><h2 id=脚本执行>脚本执行</h2><p>这部分API用于在Tcl解释器中执行Tcl脚本和表达式。</p><h3 id=tcl_eval>Tcl_Eval</h3><p><strong>功能</strong>: 在解释器中执行Tcl脚本</p><p><strong>语法</strong>: <code>int Tcl_Eval(Tcl_Interp *interp, const char *script)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 执行脚本的解释器</li><li><code>script</code>: 要执行的Tcl脚本字符串</li></ul><p><strong>返回值</strong>: TCL_OK表示成功，TCL_ERROR表示失败</p><p><strong>说明</strong>:</p><ul><li>执行给定的Tcl脚本</li><li>结果存储在解释器的结果中</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>script <span style=color:#fe8019>=</span> <span style=color:#b8bb26>&#34;set x 10; incr x&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_Eval</span>(interp, script) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetStringResult</span>(interp));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Error: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetStringResult</span>(interp));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_evalex>Tcl_EvalEx</h3><p><strong>功能</strong>: 在解释器中执行Tcl脚本，带有额外选项</p><p><strong>语法</strong>: <code>int Tcl_EvalEx(Tcl_Interp *interp, const char *script, int length, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 执行脚本的解释器</li><li><code>script</code>: 要执行的Tcl脚本字符串</li><li><code>length</code>: 脚本的长度（如果为-1，则使用strlen计算）</li><li><code>flags</code>: 执行标志（如TCL_EVAL_GLOBAL）</li></ul><p><strong>返回值</strong>: TCL_OK表示成功，TCL_ERROR表示失败</p><p><strong>说明</strong>:</p><ul><li>比Tcl_Eval更灵活，可以指定脚本长度和执行标志</li><li>常用于执行全局范围的脚本</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>script <span style=color:#fe8019>=</span> <span style=color:#b8bb26>&#34;set x 20; return $x&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>int</span> result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_EvalEx</span>(interp, script, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>, TCL_EVAL_GLOBAL);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (result <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetStringResult</span>(interp));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>}
</span></span></code></pre></div><h3 id=tcl_evalobj>Tcl_EvalObj</h3><p><strong>功能</strong>: 执行Tcl_Obj对象表示的脚本</p><p><strong>语法</strong>: <code>int Tcl_EvalObj(Tcl_Interp *interp, Tcl_Obj *objPtr)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 执行脚本的解释器</li><li><code>objPtr</code>: 包含Tcl脚本的Tcl_Obj对象</li></ul><p><strong>返回值</strong>: TCL_OK表示成功，TCL_ERROR表示失败</p><p><strong>说明</strong>:</p><ul><li>用于执行存储在Tcl_Obj中的脚本</li><li>通常比Tcl_Eval更高效，特别是对于重复执行的脚本</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>scriptObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;expr 2 + 2&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_EvalObj</span>(interp, scriptObj) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetStringResult</span>(interp));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_DecrRefCount</span>(scriptObj);
</span></span></code></pre></div><h3 id=tcl_evalobjex>Tcl_EvalObjEx</h3><p><strong>功能</strong>: 在指定的解释器中执行 Tcl 脚本对象</p><p><strong>语法</strong>: <code>int Tcl_EvalObjEx(Tcl_Interp *interp, Tcl_Obj *objPtr, int flags)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,其他值表示错误</p><p><strong>说明</strong>:</p><ul><li>执行由 objPtr 表示的 Tcl 脚本</li><li>flags 参数可以是 TCL_EVAL_GLOBAL 或 0</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>scriptObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;puts {Hello, World!}&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>int</span> result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_EvalObjEx</span>(interp, scriptObj, <span style=color:#d3869b>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (result <span style=color:#fe8019>!=</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>    <span style=color:#928374;font-style:italic>// 处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#928374;font-style:italic></span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span><span style=color:#fabd2f>Tcl_DecrRefCount</span>(scriptObj);
</span></span></code></pre></div><h3 id=tcl_globaleval>Tcl_GlobalEval</h3><p><strong>功能</strong>: 在全局范围内执行Tcl脚本</p><p><strong>语法</strong>: <code>int Tcl_GlobalEval(Tcl_Interp *interp, const char *script)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 执行脚本的解释器</li><li><code>script</code>: 要执行的Tcl脚本字符串</li></ul><p><strong>返回值</strong>: TCL_OK表示成功，TCL_ERROR表示失败</p><p><strong>说明</strong>:</p><ul><li>在全局范围内执行脚本，忽略当前过程的局部变量</li><li>等同于在Tcl中使用<code>global</code>命令</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>script <span style=color:#fe8019>=</span> <span style=color:#b8bb26>&#34;set ::globalVar 100&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_GlobalEval</span>(interp, script) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Global variable set</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span></code></pre></div><h3 id=tcl_globalevalobj>Tcl_GlobalEvalObj</h3><p><strong>功能</strong>: 在全局级别执行 Tcl 脚本对象</p><p><strong>语法</strong>: <code>int Tcl_GlobalEvalObj(Tcl_Interp *interp, Tcl_Obj *objPtr)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,其他值表示错误</p><p><strong>说明</strong>:</p><ul><li>在全局级别执行脚本,忽略当前过程调用栈</li><li>等同于在顶层调用 Tcl_EvalObjEx 并设置 TCL_EVAL_GLOBAL 标志</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>scriptObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;set ::globalVar 42&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>int</span> result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GlobalEvalObj</span>(interp, scriptObj);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (result <span style=color:#fe8019>!=</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>    <span style=color:#928374;font-style:italic>// 处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#928374;font-style:italic></span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span><span style=color:#fabd2f>Tcl_DecrRefCount</span>(scriptObj);
</span></span></code></pre></div><h3 id=tcl_vareval>Tcl_VarEval</h3><p><strong>功能</strong>: 连接多个字符串并作为Tcl脚本执行</p><p><strong>语法</strong>: <code>int Tcl_VarEval(Tcl_Interp *interp, ...)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 执行脚本的解释器</li><li><code>...</code>: 可变数量的字符串参数，以NULL结束</li></ul><p><strong>返回值</strong>: TCL_OK表示成功，TCL_ERROR表示失败</p><p><strong>说明</strong>:</p><ul><li>将多个字符串连接成一个脚本并执行</li><li>最后一个参数必须是NULL</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_VarEval</span>(interp, <span style=color:#b8bb26>&#34;set x 10; &#34;</span>, <span style=color:#b8bb26>&#34;incr x; &#34;</span>, <span style=color:#b8bb26>&#34;return $x&#34;</span>, <span style=color:#fabd2f>NULL</span>) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetStringResult</span>(interp));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>}
</span></span></code></pre></div><h3 id=tcl_exprobj>Tcl_ExprObj</h3><p><strong>功能</strong>: 计算Tcl表达式</p><p><strong>语法</strong>: <code>int Tcl_ExprObj(Tcl_Interp *interp, Tcl_Obj *objPtr, Tcl_Obj **resultPtrPtr)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 执行表达式的解释器</li><li><code>objPtr</code>: 包含表达式的Tcl_Obj对象</li><li><code>resultPtrPtr</code>: 指向Tcl_Obj指针的指针，用于存储结果</li></ul><p><strong>返回值</strong>: TCL_OK表示成功，TCL_ERROR表示失败</p><p><strong>说明</strong>:</p><ul><li>计算Tcl表达式并返回结果</li><li>结果存储在<code>resultPtrPtr</code>指向的Tcl_Obj中</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>exprObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;2 * (3 + 4)&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Tcl_Obj <span style=color:#fe8019>*</span>resultObj;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_ExprObj</span>(interp, exprObj, <span style=color:#fe8019>&amp;</span>resultObj) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>int</span> result;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_GetIntFromObj</span>(interp, resultObj, <span style=color:#fe8019>&amp;</span>result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %d</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">8</span><span><span style=color:#fabd2f>Tcl_DecrRefCount</span>(exprObj);
</span></span></code></pre></div><h3 id=tcl_exprstring>Tcl_ExprString</h3><p><strong>功能</strong>: 计算字符串形式的Tcl表达式</p><p><strong>语法</strong>: <code>int Tcl_ExprString(Tcl_Interp *interp, const char *expr)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 执行表达式的解释器</li><li><code>expr</code>: 包含表达式的字符串</li></ul><p><strong>返回值</strong>: TCL_OK表示成功，TCL_ERROR表示失败</p><p><strong>说明</strong>:</p><ul><li>计算字符串形式的Tcl表达式</li><li>结果存储在解释器的结果中</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>expr <span style=color:#fe8019>=</span> <span style=color:#b8bb26>&#34;5 + 3 * 2&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_ExprString</span>(interp, expr) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetStringResult</span>(interp));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span></code></pre></div><h3 id=tcl_exprlong>Tcl_ExprLong</h3><p><strong>功能</strong>: 计算 Tcl 表达式并返回长整型结果</p><p><strong>语法</strong>: <code>int Tcl_ExprLong(Tcl_Interp *interp, const char *expr, long *longPtr)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,其他值表示错误</p><p><strong>说明</strong>:</p><ul><li>计算字符串形式的 Tcl 表达式</li><li>结果存储在 longPtr 指向的位置
<strong>示例</strong>:</li></ul><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>long</span> result;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>int</span> status <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_ExprLong</span>(interp, <span style=color:#b8bb26>&#34;2 + 3 * 4&#34;</span>, <span style=color:#fe8019>&amp;</span>result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (status <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %ld</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>    <span style=color:#928374;font-style:italic>// 处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_exprdouble>Tcl_ExprDouble</h3><p><strong>功能</strong>: 计算 Tcl 表达式并返回双精度浮点型结果</p><p><strong>语法</strong>: <code>int Tcl_ExprDouble(Tcl_Interp *interp, const char *expr, double *doublePtr)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,其他值表示错误</p><p><strong>说明</strong>:</p><ul><li>计算字符串形式的 Tcl 表达式</li><li>结果存储在 doublePtr 指向的位置</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>double</span> result;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>int</span> status <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_ExprDouble</span>(interp, <span style=color:#b8bb26>&#34;3.14 * 2.0&#34;</span>, <span style=color:#fe8019>&amp;</span>result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (status <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %f</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>    <span style=color:#928374;font-style:italic>// 处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_exprboolean>Tcl_ExprBoolean</h3><p><strong>功能</strong>: 计算 Tcl 表达式并返回布尔结果</p><p><strong>语法</strong>: <code>int Tcl_ExprBoolean(Tcl_Interp *interp, const char *expr, int *boolPtr)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,其他值表示错误</p><p><strong>说明</strong>:</p><ul><li>计算字符串形式的 Tcl 表达式</li><li>结果存储在 boolPtr 指向的位置(0 表示 false,1 表示 true)</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> result;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>int</span> status <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_ExprBoolean</span>(interp, <span style=color:#b8bb26>&#34;5 &gt; 3&#34;</span>, <span style=color:#fe8019>&amp;</span>result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (status <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result <span style=color:#fe8019>?</span> <span style=color:#b8bb26>&#34;true&#34;</span> <span style=color:#fe8019>:</span> <span style=color:#b8bb26>&#34;false&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>    <span style=color:#928374;font-style:italic>// 处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_substobj>Tcl_SubstObj</h3><p><strong>功能</strong>: 对 Tcl 对象进行替换处理</p><p><strong>语法</strong>: <code>Tcl_Obj *Tcl_SubstObj(Tcl_Interp *interp, Tcl_Obj *objPtr, int flags)</code></p><p><strong>返回值</strong>: 新的 Tcl 对象,包含替换后的结果</p><p><strong>说明</strong>:</p><ul><li>对给定的 Tcl 对象进行变量和命令替换</li><li>flags 参数控制替换的类型(TCL_SUBST_VARIABLES, TCL_SUBST_COMMANDS 等)</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>originalObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;Hello, $name!&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Tcl_Obj <span style=color:#fe8019>*</span>resultObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_SubstObj</span>(interp, originalObj, TCL_SUBST_VARIABLES);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (resultObj <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>    <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetString</span>(resultObj);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Substituted: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>    <span style=color:#fabd2f>Tcl_DecrRefCount</span>(resultObj);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">8</span><span><span style=color:#fabd2f>Tcl_DecrRefCount</span>(originalObj);
</span></span></code></pre></div><h2 id=命令创建和管理>命令创建和管理</h2><p>这部分API用于创建新的Tcl命令、管理现有命令，以及处理命令相关的操作。</p><h3 id=tcl_createcommand>Tcl_CreateCommand</h3><p><strong>功能</strong>: 创建一个新的 Tcl 命令</p><p><strong>语法</strong>: <code>Tcl_Command Tcl_CreateCommand(Tcl_Interp *interp, const char *cmdName, Tcl_CmdProc *proc, ClientData clientData, Tcl_CmdDeleteProc *deleteProc)</code></p><p><strong>返回值</strong>: 新创建的命令的令牌</p><p><strong>说明</strong>:</p><ul><li>在解释器中创建一个新的 Tcl 命令</li><li>proc 是命令的实现函数</li><li>clientData 是传递给 proc 和 deleteProc 的任意数据</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> <span style=color:#fabd2f>HelloCmd</span>(ClientData clientData, Tcl_Interp <span style=color:#fe8019>*</span>interp, <span style=color:#fabd2f>int</span> objc, Tcl_Obj <span style=color:#fe8019>*</span><span style=color:#fe8019>const</span> objv[]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>    <span style=color:#fabd2f>Tcl_SetResult</span>(interp, <span style=color:#b8bb26>&#34;Hello, World!&#34;</span>, TCL_STATIC);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fe8019>return</span> TCL_OK;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_CreateCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, HelloCmd, <span style=color:#fabd2f>NULL</span>, <span style=color:#fabd2f>NULL</span>);
</span></span></code></pre></div><h3 id=tcl_createobjcommand>Tcl_CreateObjCommand</h3><p><strong>功能</strong>: 创建一个新的Tcl命令</p><p><strong>语法</strong>: <code>Tcl_Command Tcl_CreateObjCommand(Tcl_Interp *interp, const char *cmdName, Tcl_ObjCmdProc *proc, ClientData clientData, Tcl_CmdDeleteProc *deleteProc)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>cmdName</code>: 新命令的名称</li><li><code>proc</code>: 实现命令的C函数</li><li><code>clientData</code>: 传递给命令处理函数的客户端数据</li><li><code>deleteProc</code>: 命令被删除时调用的函数（可为NULL）</li></ul><p><strong>返回值</strong>: 新创建命令的令牌</p><p><strong>说明</strong>:</p><ul><li>创建一个新的Tcl命令，该命令可以从Tcl脚本中调用</li><li><code>proc</code>函数接收Tcl_Obj参数，通常比Tcl_CreateCommand更高效</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> <span style=color:#fabd2f>HelloCmd</span>(ClientData clientData, Tcl_Interp <span style=color:#fe8019>*</span>interp, <span style=color:#fabd2f>int</span> objc, Tcl_Obj <span style=color:#fe8019>*</span><span style=color:#fe8019>const</span> objv[]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>    <span style=color:#fabd2f>Tcl_SetObjResult</span>(interp, <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;Hello, World!&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fe8019>return</span> TCL_OK;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_CreateObjCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, HelloCmd, <span style=color:#fabd2f>NULL</span>, <span style=color:#fabd2f>NULL</span>);
</span></span></code></pre></div><h3 id=tcl_deletecommand>Tcl_DeleteCommand</h3><p><strong>功能</strong>: 删除一个Tcl命令</p><p><strong>语法</strong>: <code>int Tcl_DeleteCommand(Tcl_Interp *interp, const char *cmdName)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>cmdName</code>: 要删除的命令名称</li></ul><p><strong>返回值</strong>: 成功返回0，失败返回-1</p><p><strong>说明</strong>:</p><ul><li>从解释器中删除指定的命令</li><li>如果命令不存在，返回-1</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_DeleteCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>) <span style=color:#fe8019>==</span> <span style=color:#d3869b>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command &#39;hello&#39; deleted successfully</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Failed to delete command &#39;hello&#39;</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>}
</span></span></code></pre></div><h3 id=tcl_getcommandinfo>Tcl_GetCommandInfo</h3><p><strong>功能</strong>: 获取命令的信息</p><p><strong>语法</strong>: <code>int Tcl_GetCommandInfo(Tcl_Interp *interp, const char *cmdName, Tcl_CmdInfo *infoPtr)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>cmdName</code>: 命令名称</li><li><code>infoPtr</code>: 指向Tcl_CmdInfo结构的指针，用于存储命令信息</li></ul><p><strong>返回值</strong>: 如果命令存在返回1，否则返回0</p><p><strong>说明</strong>:</p><ul><li>获取指定命令的详细信息，包括实现函数、客户端数据等</li><li>信息存储在infoPtr指向的结构中</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_CmdInfo info;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_GetCommandInfo</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, <span style=color:#fe8019>&amp;</span>info)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command &#39;hello&#39; exists</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic>// 使用info中的信息
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#928374;font-style:italic></span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command &#39;hello&#39; does not exist</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span>}
</span></span></code></pre></div><h3 id=tcl_setcommandinfo>Tcl_SetCommandInfo</h3><p><strong>功能</strong>: 修改现有命令的信息</p><p><strong>语法</strong>: <code>int Tcl_SetCommandInfo(Tcl_Interp *interp, const char *cmdName, const Tcl_CmdInfo *infoPtr)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>cmdName</code>: 命令名称</li><li><code>infoPtr</code>: 指向包含新信息的Tcl_CmdInfo结构的指针</li></ul><p><strong>返回值</strong>: 成功返回1，失败返回0</p><p><strong>说明</strong>:</p><ul><li>修改指定命令的实现函数、客户端数据等信息</li><li>通常用于重新定义现有命令的行为</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_CmdInfo info;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>Tcl_GetCommandInfo</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, <span style=color:#fe8019>&amp;</span>info);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>info.objProc <span style=color:#fe8019>=</span> NewHelloCmd; <span style=color:#928374;font-style:italic>// 假设NewHelloCmd是一个新的命令处理函数
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic></span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_SetCommandInfo</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, <span style=color:#fe8019>&amp;</span>info)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command &#39;hello&#39; updated</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Failed to update command &#39;hello&#39;</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">8</span><span>}
</span></span></code></pre></div><h3 id=tcl_getcommandname>Tcl_GetCommandName</h3><p><strong>功能</strong>: 获取命令的名称</p><p><strong>语法</strong>: <code>const char *Tcl_GetCommandName(Tcl_Interp *interp, Tcl_Command command)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>command</code>: 命令令牌</li></ul><p><strong>返回值</strong>: 命令的名称（字符串）</p><p><strong>说明</strong>:</p><ul><li>根据命令令牌获取命令的名称</li><li>通常用于从命令令牌反向查找命令名</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Command cmd <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_FindCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, <span style=color:#fabd2f>NULL</span>, <span style=color:#d3869b>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (cmd <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>name <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetCommandName</span>(interp, cmd);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command name: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>}
</span></span></code></pre></div><h3 id=tcl_getcommandfullname>Tcl_GetCommandFullName</h3><p><strong>功能</strong>: 获取命令的完整名称</p><p><strong>语法</strong>: <code>void Tcl_GetCommandFullName(Tcl_Interp *interp, Tcl_Command command, Tcl_Obj *objPtr)</code></p><p><strong>返回值</strong>: 无</p><p><strong>说明</strong>:</p><ul><li>获取指定命令的完整名称,包括命名空间</li><li>结果存储在 objPtr 中</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Command cmd <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_FindCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, <span style=color:#fabd2f>NULL</span>, <span style=color:#d3869b>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Tcl_Obj <span style=color:#fe8019>*</span>nameObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewObj</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>Tcl_GetCommandFullName</span>(interp, cmd, nameObj);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Full name: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetString</span>(nameObj));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_DecrRefCount</span>(nameObj);
</span></span></code></pre></div><h3 id=tcl_createensemble>Tcl_CreateEnsemble</h3><p><strong>功能</strong>: 创建一个命令集合</p><p><strong>语法</strong>: <code>Tcl_Command Tcl_CreateEnsemble(Tcl_Interp *interp, const char *name, Tcl_Namespace *namespacePtr, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>name</code>: 集合的名称</li><li><code>namespacePtr</code>: 集合所属的命名空间（可为NULL）</li><li><code>flags</code>: 控制集合行为的标志</li></ul><p><strong>返回值</strong>: 新创建集合的命令令牌</p><p><strong>说明</strong>:</p><ul><li>创建一个命令集合，可以包含多个子命令</li><li>使用集合可以组织相关的命令，提高可读性和可维护性</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Command ensemble <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_CreateEnsemble</span>(interp, <span style=color:#b8bb26>&#34;math&#34;</span>, <span style=color:#fabd2f>NULL</span>, <span style=color:#d3869b>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Tcl_Obj <span style=color:#fe8019>*</span>subcommands <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewListObj</span>(<span style=color:#d3869b>0</span>, <span style=color:#fabd2f>NULL</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>Tcl_ListObjAppendElement</span>(interp, subcommands, <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;add&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>Tcl_ListObjAppendElement</span>(interp, subcommands, <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;subtract&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_SetEnsembleSubcommandList</span>(interp, ensemble, subcommands);
</span></span></code></pre></div><h3 id=tcl_findcommand>Tcl_FindCommand</h3><p><strong>功能</strong>: 查找指定名称的命令</p><p><strong>语法</strong>: <code>Tcl_Command Tcl_FindCommand(Tcl_Interp *interp, const char *name, Tcl_Namespace *contextNsPtr, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>name</code>: 要查找的命令名称</li><li><code>contextNsPtr</code>: 搜索的上下文命名空间（可为NULL）</li><li><code>flags</code>: 控制查找行为的标志</li></ul><p><strong>返回值</strong>: 找到的命令的令牌，如果未找到则返回NULL</p><p><strong>说明</strong>:</p><ul><li>在指定的上下文中查找命令</li><li>可以用于检查命令是否存在，或获取命令的令牌以进行进一步操作</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Command cmd <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_FindCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, <span style=color:#fabd2f>NULL</span>, <span style=color:#d3869b>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (cmd <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command &#39;hello&#39; found</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command &#39;hello&#39; not found</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_tracecommand>Tcl_TraceCommand</h3><p><strong>功能</strong>: 为命令添加跟踪</p><p><strong>语法</strong>: <code>int Tcl_TraceCommand(Tcl_Interp *interp, const char *cmdName, int flags, Tcl_CmdTraceProc *proc, ClientData clientData)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,TCL_ERROR 表示失败</p><p><strong>说明</strong>:</p><ul><li>为指定的命令添加跟踪回调</li><li>flags 指定何时调用跟踪过程(TCL_TRACE_RENAME, TCL_TRACE_DELETE 等)</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> <span style=color:#fabd2f>CmdTraceProc</span>(ClientData clientData, Tcl_Interp <span style=color:#fe8019>*</span>interp, <span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>oldName, <span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>newName, <span style=color:#fabd2f>int</span> flags) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command %s traced</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, oldName);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fe8019>return</span> TCL_OK;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_TraceCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, TCL_TRACE_RENAME <span style=color:#fe8019>|</span> TCL_TRACE_DELETE, CmdTraceProc, <span style=color:#fabd2f>NULL</span>);
</span></span></code></pre></div><h3 id=tcl_untracecommand>Tcl_UntraceCommand</h3><p><strong>功能</strong>: 移除命令的跟踪</p><p><strong>语法</strong>: <code>void Tcl_UntraceCommand(Tcl_Interp *interp, const char *cmdName, int flags, Tcl_CmdTraceProc *proc, ClientData clientData)</code></p><p><strong>返回值</strong>: 无</p><p><strong>说明</strong>:</p><ul><li>移除之前通过 Tcl_TraceCommand 添加的跟踪</li><li>参数必须与添加跟踪时使用的参数完全匹配</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_UntraceCommand</span>(interp, <span style=color:#b8bb26>&#34;hello&#34;</span>, TCL_TRACE_RENAME <span style=color:#fe8019>|</span> TCL_TRACE_DELETE, CmdTraceProc, <span style=color:#fabd2f>NULL</span>);
</span></span></code></pre></div><h2 id=变量操作>变量操作</h2><p>这部分API用于在Tcl环境中创建、修改、获取和删除变量。</p><h3 id=tcl_setvar>Tcl_SetVar</h3><p><strong>功能</strong>: 设置Tcl变量的值</p><p><strong>语法</strong>: <code>const char *Tcl_SetVar(Tcl_Interp *interp, const char *varName, const char *newValue, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>varName</code>: 变量名</li><li><code>newValue</code>: 新的变量值</li><li><code>flags</code>: 控制变量设置行为的标志（如TCL_GLOBAL_ONLY）</li></ul><p><strong>返回值</strong>: 成功返回变量的新值，失败返回NULL</p><p><strong>说明</strong>:</p><ul><li>设置或创建一个Tcl变量</li><li>可以通过flags参数控制变量的作用域和行为</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_SetVar</span>(interp, <span style=color:#b8bb26>&#34;x&#34;</span>, <span style=color:#b8bb26>&#34;100&#34;</span>, TCL_GLOBAL_ONLY);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (result <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Variable &#39;x&#39; set to: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Failed to set variable &#39;x&#39;</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_setvar2>Tcl_SetVar2</h3><p><strong>功能</strong>: 设置数组元素或嵌套变量的值</p><p><strong>语法</strong>: <code>const char *Tcl_SetVar2(Tcl_Interp *interp, const char *part1, const char *part2, const char *newValue, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>part1</code>: 变量名或数组名</li><li><code>part2</code>: 数组索引或嵌套变量名（可为NULL）</li><li><code>newValue</code>: 新的变量值</li><li><code>flags</code>: 控制变量设置行为的标志</li></ul><p><strong>返回值</strong>: 成功返回变量的新值，失败返回NULL</p><p><strong>说明</strong>:</p><ul><li>用于设置数组元素或嵌套变量的值</li><li>如果part2为NULL，则行为与Tcl_SetVar相同</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_SetVar2</span>(interp, <span style=color:#b8bb26>&#34;arr&#34;</span>, <span style=color:#b8bb26>&#34;index&#34;</span>, <span style=color:#b8bb26>&#34;value&#34;</span>, TCL_GLOBAL_ONLY);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (result <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Array element &#39;arr(index)&#39; set to: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Failed to set array element</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_setvar2ex>Tcl_SetVar2Ex</h3><p><strong>功能</strong>: 设置变量的值</p><p><strong>语法</strong>: <code>Tcl_Obj *Tcl_SetVar2Ex(Tcl_Interp *interp, const char *part1, const char *part2, Tcl_Obj *newValuePtr, int flags)</code></p><p><strong>返回值</strong>: 指向变量新值的 Tcl_Obj 指针,如果出错则返回 NULL</p><p><strong>说明</strong>:</p><ul><li>设置一个变量的值,可以是标量或数组元素</li><li>part1 是变量名,part2 用于数组元素(可以为 NULL)</li><li>flags 控制变量的查找和设置方式</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>value <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewIntObj</span>(<span style=color:#d3869b>42</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>Tcl_SetVar2Ex</span>(interp, <span style=color:#b8bb26>&#34;myVar&#34;</span>, <span style=color:#fabd2f>NULL</span>, value, TCL_LEAVE_ERR_MSG);
</span></span></code></pre></div><h3 id=tcl_getvar>Tcl_GetVar</h3><p><strong>功能</strong>: 获取Tcl变量的值</p><p><strong>语法</strong>: <code>const char *Tcl_GetVar(Tcl_Interp *interp, const char *varName, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>varName</code>: 变量名</li><li><code>flags</code>: 控制变量获取行为的标志</li></ul><p><strong>返回值</strong>: 成功返回变量的值，失败返回NULL</p><p><strong>说明</strong>:</p><ul><li>获取指定Tcl变量的值</li><li>可以通过flags参数控制变量的作用域和行为</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>value <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetVar</span>(interp, <span style=color:#b8bb26>&#34;x&#34;</span>, TCL_GLOBAL_ONLY);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (value <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Value of &#39;x&#39;: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, value);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Variable &#39;x&#39; not found</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_getvar2>Tcl_GetVar2</h3><p><strong>功能</strong>: 获取数组元素或嵌套变量的值</p><p><strong>语法</strong>: <code>const char *Tcl_GetVar2(Tcl_Interp *interp, const char *part1, const char *part2, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>part1</code>: 变量名或数组名</li><li><code>part2</code>: 数组索引或嵌套变量名（可为NULL）</li><li><code>flags</code>: 控制变量获取行为的标志</li></ul><p><strong>返回值</strong>: 成功返回变量的值，失败返回NULL</p><p><strong>说明</strong>:</p><ul><li>用于获取数组元素或嵌套变量的值</li><li>如果part2为NULL，则行为与Tcl_GetVar相同</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>value <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetVar2</span>(interp, <span style=color:#b8bb26>&#34;arr&#34;</span>, <span style=color:#b8bb26>&#34;index&#34;</span>, TCL_GLOBAL_ONLY);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (value <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Value of &#39;arr(index)&#39;: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, value);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Array element not found</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_getvar2ex>Tcl_GetVar2Ex</h3><p><strong>功能</strong>: 获取变量的值</p><p><strong>语法</strong>: <code>Tcl_Obj *Tcl_GetVar2Ex(Tcl_Interp *interp, const char *part1, const char *part2, int flags)</code></p><p><strong>返回值</strong>: 指向变量值的 Tcl_Obj 指针,如果变量不存在则返回 NULL</p><p><strong>说明</strong>:</p><ul><li>获取一个变量的值,可以是标量或数组元素</li><li>part1 是变量名,part2 用于数组元素(可以为 NULL)</li><li>flags 控制变量的查找方式</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>value <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetVar2Ex</span>(interp, <span style=color:#b8bb26>&#34;myVar&#34;</span>, <span style=color:#fabd2f>NULL</span>, TCL_LEAVE_ERR_MSG);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (value) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fabd2f>int</span> intValue;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>    <span style=color:#fabd2f>Tcl_GetIntFromObj</span>(interp, value, <span style=color:#fe8019>&amp;</span>intValue);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Value: %d</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, intValue);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_unsetvar>Tcl_UnsetVar</h3><p><strong>功能</strong>: 删除Tcl变量</p><p><strong>语法</strong>: <code>int Tcl_UnsetVar(Tcl_Interp *interp, const char *varName, int flags)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>varName</code>: 要删除的变量名</li><li><code>flags</code>: 控制变量删除行为的标志</li></ul><p><strong>返回值</strong>: 成功返回TCL_OK，失败返回TCL_ERROR</p><p><strong>说明</strong>:</p><ul><li>删除指定的Tcl变量</li><li>可以通过flags参数控制变量的作用域和行为</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_UnsetVar</span>(interp, <span style=color:#b8bb26>&#34;x&#34;</span>, TCL_GLOBAL_ONLY) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Variable &#39;x&#39; unset successfully</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Failed to unset variable &#39;x&#39;</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>}
</span></span></code></pre></div><h3 id=tcl_unsetvar2>Tcl_UnsetVar2</h3><p><strong>功能</strong>: 删除变量</p><p><strong>语法</strong>: <code>int Tcl_UnsetVar2(Tcl_Interp *interp, const char *part1, const char *part2, int flags)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,TCL_ERROR 表示失败</p><p><strong>说明</strong>:</p><ul><li>删除一个变量,可以是标量或数组元素</li><li>part1 是变量名,part2 用于数组元素(可以为 NULL)</li><li>flags 控制变量的查找和删除方式</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_UnsetVar2</span>(interp, <span style=color:#b8bb26>&#34;myVar&#34;</span>, <span style=color:#fabd2f>NULL</span>, TCL_LEAVE_ERR_MSG);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (result <span style=color:#fe8019>!=</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#928374;font-style:italic>// 处理错误
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#928374;font-style:italic></span>}
</span></span></code></pre></div><h3 id=tcl_linkvar>Tcl_LinkVar</h3><p><strong>功能</strong>: 将C变量链接到Tcl变量</p><p><strong>语法</strong>: <code>int Tcl_LinkVar(Tcl_Interp *interp, const char *varName, char *addr, int type)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>varName</code>: Tcl变量名</li><li><code>addr</code>: C变量的地址</li><li><code>type</code>: 变量类型（如TCL_LINK_INT, TCL_LINK_DOUBLE等）</li></ul><p><strong>返回值</strong>: 成功返回TCL_OK，失败返回TCL_ERROR</p><p><strong>说明</strong>:</p><ul><li>建立Tcl变量和C变量之间的双向链接</li><li>当一方变化时，另一方会自动更新</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> cVar <span style=color:#fe8019>=</span> <span style=color:#d3869b>42</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_LinkVar</span>(interp, <span style=color:#b8bb26>&#34;tclVar&#34;</span>, (<span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>)<span style=color:#fe8019>&amp;</span>cVar, TCL_LINK_INT) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Variable linked successfully</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>} <span style=color:#fe8019>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Failed to link variable</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_unlinkvar>Tcl_UnlinkVar</h3><p><strong>功能</strong>: 解除C变量与Tcl变量的链接</p><p><strong>语法</strong>: <code>void Tcl_UnlinkVar(Tcl_Interp *interp, const char *varName)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>varName</code>: 要解除链接的Tcl变量名</li></ul><p><strong>说明</strong>:</p><ul><li>解除之前通过Tcl_LinkVar建立的变量链接</li><li>解除链接后，Tcl变量和C变量将不再同步</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_UnlinkVar</span>(interp, <span style=color:#b8bb26>&#34;tclVar&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Variable &#39;tclVar&#39; unlinked</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span></code></pre></div><h3 id=tcl_updatelinkedvar>Tcl_UpdateLinkedVar</h3><p><strong>功能</strong>: 更新链接变量的值</p><p><strong>语法</strong>: <code>void Tcl_UpdateLinkedVar(Tcl_Interp *interp, const char *varName)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>varName</code>: 要更新的Tcl变量名</li></ul><p><strong>说明</strong>:</p><ul><li>强制更新链接变量的值，将C变量的值同步到Tcl变量</li><li>通常在C代码中修改链接变量后调用</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>cVar <span style=color:#fe8019>=</span> <span style=color:#d3869b>100</span>; <span style=color:#928374;font-style:italic>// 修改C变量
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#928374;font-style:italic></span><span style=color:#fabd2f>Tcl_UpdateLinkedVar</span>(interp, <span style=color:#b8bb26>&#34;tclVar&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Linked variable updated</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span></code></pre></div><h3 id=tcl_tracevar>Tcl_TraceVar</h3><p><strong>功能</strong>: 为变量添加跟踪</p><p><strong>语法</strong>: <code>int Tcl_TraceVar(Tcl_Interp *interp, const char *varName, int flags, Tcl_VarTraceProc *proc, ClientData clientData)</code></p><p><strong>返回值</strong>: TCL_OK 表示成功,TCL_ERROR 表示失败</p><p><strong>说明</strong>:</p><ul><li>为指定的变量添加跟踪回调</li><li>flags 指定何时调用跟踪过程(TCL_TRACE_READS, TCL_TRACE_WRITES 等)</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span><span style=color:#fabd2f>VarTraceProc</span>(ClientData clientData, Tcl_Interp <span style=color:#fe8019>*</span>interp, <span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>name1, <span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>name2, <span style=color:#fabd2f>int</span> flags) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Variable %s traced</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, name1);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fe8019>return</span> <span style=color:#fabd2f>NULL</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>Tcl_TraceVar</span>(interp, <span style=color:#b8bb26>&#34;myVar&#34;</span>, TCL_TRACE_READS <span style=color:#fe8019>|</span> TCL_TRACE_WRITES, VarTraceProc, <span style=color:#fabd2f>NULL</span>);
</span></span></code></pre></div><h3 id=tcl_untracevar>Tcl_UntraceVar</h3><p><strong>功能</strong>: 移除变量的跟踪</p><p><strong>语法</strong>: <code>void Tcl_UntraceVar(Tcl_Interp *interp, const char *varName, int flags, Tcl_VarTraceProc *proc, ClientData clientData)</code></p><p><strong>返回值</strong>: 无</p><p><strong>说明</strong>:</p><ul><li>移除之前通过 Tcl_TraceVar 添加的跟踪</li><li>参数必须与添加跟踪时使用的参数完全匹配</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_UntraceVar</span>(interp, <span style=color:#b8bb26>&#34;myVar&#34;</span>, TCL_TRACE_READS <span style=color:#fe8019>|</span> TCL_TRACE_WRITES, VarTraceProc, <span style=color:#fabd2f>NULL</span>);
</span></span></code></pre></div><h3 id=tcl_vartraceinfo>Tcl_VarTraceInfo</h3><p><strong>功能</strong>: 获取变量的跟踪信息</p><p><strong>语法</strong>: <code>ClientData Tcl_VarTraceInfo(Tcl_Interp *interp, const char *varName, int flags, Tcl_VarTraceProc *procPtr, ClientData prevClientData)</code></p><p><strong>返回值</strong>: 下一个跟踪的 ClientData,如果没有更多跟踪则返回 NULL</p><p><strong>说明</strong>:</p><ul><li>获取变量上的跟踪信息</li><li>可以用来遍历所有与变量相关的跟踪</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>ClientData clientData <span style=color:#fe8019>=</span> <span style=color:#fabd2f>NULL</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fe8019>while</span> ((clientData <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_VarTraceInfo</span>(interp, <span style=color:#b8bb26>&#34;myVar&#34;</span>, TCL_TRACE_READS, VarTraceProc, clientData)) <span style=color:#fe8019>!=</span> <span style=color:#fabd2f>NULL</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>    <span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Found trace for myVar</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>}
</span></span></code></pre></div><h2 id=结果处理>结果处理</h2><p>这部分API用于设置、获取和操作Tcl命令的结果。在Tcl中，每个命令执行后都会产生一个结果，这些API允许C代码设置和检索这些结果。</p><h3 id=tcl_setresult>Tcl_SetResult</h3><p><strong>功能</strong>: 设置解释器的结果</p><p><strong>语法</strong>: <code>void Tcl_SetResult(Tcl_Interp *interp, char *result, Tcl_FreeProc *freeProc)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>result</code>: 要设置的结果字符串</li><li><code>freeProc</code>: 用于释放结果内存的函数（可以是TCL_STATIC, TCL_VOLATILE, TCL_DYNAMIC, 或自定义函数）</li></ul><p><strong>说明</strong>:</p><ul><li>设置命令执行的结果</li><li><code>freeProc</code>参数决定了结果字符串的内存管理方式</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_SetResult</span>(interp, <span style=color:#b8bb26>&#34;Command executed successfully&#34;</span>, TCL_STATIC);
</span></span></code></pre></div><h3 id=tcl_setobjresult>Tcl_SetObjResult</h3><p><strong>功能</strong>: 设置解释器的结果为Tcl对象</p><p><strong>语法</strong>: <code>void Tcl_SetObjResult(Tcl_Interp *interp, Tcl_Obj *objPtr)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>objPtr</code>: 要设置为结果的Tcl对象</li></ul><p><strong>说明</strong>:</p><ul><li>设置命令执行的结果为Tcl对象</li><li>比Tcl_SetResult更高效，特别是对于非字符串类型的结果</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>resultObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewIntObj</span>(<span style=color:#d3869b>42</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>Tcl_SetObjResult</span>(interp, resultObj);
</span></span></code></pre></div><h3 id=tcl_appendresult>Tcl_AppendResult</h3><p><strong>功能</strong>: 向解释器的结果追加一个或多个字符串</p><p><strong>语法</strong>: <code>void Tcl_AppendResult(Tcl_Interp *interp, ...)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>...</code>: 要追加的字符串，以NULL结束</li></ul><p><strong>说明</strong>:</p><ul><li>向现有结果追加一个或多个字符串</li><li>最后一个参数必须是NULL</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_AppendResult</span>(interp, <span style=color:#b8bb26>&#34;First part&#34;</span>, <span style=color:#b8bb26>&#34;, &#34;</span>, <span style=color:#b8bb26>&#34;Second part&#34;</span>, <span style=color:#fabd2f>NULL</span>);
</span></span></code></pre></div><h3 id=tcl_appendelement>Tcl_AppendElement</h3><p><strong>功能</strong>: 向解释器的结果追加一个列表元素</p><p><strong>语法</strong>: <code>void Tcl_AppendElement(Tcl_Interp *interp, const char *element)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>element</code>: 要追加的列表元素</li></ul><p><strong>说明</strong>:</p><ul><li>将给定的字符串作为一个列表元素追加到结果中</li><li>自动处理引号和空格等特殊字符</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_AppendElement</span>(interp, <span style=color:#b8bb26>&#34;element with spaces&#34;</span>);
</span></span></code></pre></div><h3 id=tcl_getobjresult>Tcl_GetObjResult</h3><p><strong>功能</strong>: 获取解释器的结果对象</p><p><strong>语法</strong>: <code>Tcl_Obj *Tcl_GetObjResult(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li></ul><p><strong>返回值</strong>: 当前的结果对象</p><p><strong>说明</strong>:</p><ul><li>获取当前命令执行的结果对象</li><li>返回的对象是共享的，不应该直接修改</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>resultObj <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetObjResult</span>(interp);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>int</span> intResult;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_GetIntFromObj</span>(interp, resultObj, <span style=color:#fe8019>&amp;</span>intResult) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result as integer: %d</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, intResult);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>}
</span></span></code></pre></div><h3 id=tcl_getstringresult>Tcl_GetStringResult</h3><p><strong>功能</strong>: 获取解释器结果的字符串表示</p><p><strong>语法</strong>: <code>const char *Tcl_GetStringResult(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li></ul><p><strong>返回值</strong>: 结果的字符串表示</p><p><strong>说明</strong>:</p><ul><li>获取当前命令执行结果的字符串形式</li><li>返回的字符串不应被修改或释放</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>const</span> <span style=color:#fabd2f>char</span> <span style=color:#fe8019>*</span>result <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetStringResult</span>(interp);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Command result: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, result);
</span></span></code></pre></div><h3 id=tcl_resetresult>Tcl_ResetResult</h3><p><strong>功能</strong>: 重置解释器的结果</p><p><strong>语法</strong>: <code>void Tcl_ResetResult(Tcl_Interp *interp)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li></ul><p><strong>说明</strong>:</p><ul><li>清除当前的结果，将其重置为空字符串</li><li>同时清除任何错误信息</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>Tcl_ResetResult</span>(interp);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Result has been reset</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span></code></pre></div><h3 id=tcl_setreturnoptions>Tcl_SetReturnOptions</h3><p><strong>功能</strong>: 设置命令返回的选项</p><p><strong>语法</strong>: <code>int Tcl_SetReturnOptions(Tcl_Interp *interp, Tcl_Obj *options)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>options</code>: 包含返回选项的字典对象</li></ul><p><strong>返回值</strong>: 成功返回TCL_OK，失败返回TCL_ERROR</p><p><strong>说明</strong>:</p><ul><li>设置命令返回的附加信息，如错误代码、错误信息等</li><li>通常用于高级错误处理和异常管理</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>Tcl_Obj <span style=color:#fe8019>*</span>options <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_NewDictObj</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#fabd2f>Tcl_DictObjPut</span>(interp, options, <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;-code&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>), <span style=color:#fabd2f>Tcl_NewIntObj</span>(<span style=color:#d3869b>1</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#fabd2f>Tcl_DictObjPut</span>(interp, options, <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;-errorinfo&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>), <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;Error occurred&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_SetReturnOptions</span>(interp, options) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Return options set successfully</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div><h3 id=tcl_getreturnoptions>Tcl_GetReturnOptions</h3><p><strong>功能</strong>: 获取命令返回的选项</p><p><strong>语法</strong>: <code>Tcl_Obj *Tcl_GetReturnOptions(Tcl_Interp *interp, int result)</code></p><p><strong>参数</strong>:</p><ul><li><code>interp</code>: 解释器</li><li><code>result</code>: 命令的返回代码</li></ul><p><strong>返回值</strong>: 包含返回选项的字典对象</p><p><strong>说明</strong>:</p><ul><li>获取命令执行后的返回选项</li><li>通常用于错误处理和获取额外的返回信息</li></ul><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fabd2f>int</span> result <span style=color:#fe8019>=</span> <span style=color:#928374;font-style:italic>/* 某个Tcl命令的执行结果 */</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Tcl_Obj <span style=color:#fe8019>*</span>options <span style=color:#fe8019>=</span> <span style=color:#fabd2f>Tcl_GetReturnOptions</span>(interp, result);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>Tcl_Obj <span style=color:#fe8019>*</span>errorInfo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span><span style=color:#fe8019>if</span> (<span style=color:#fabd2f>Tcl_DictObjGet</span>(interp, options, <span style=color:#fabd2f>Tcl_NewStringObj</span>(<span style=color:#b8bb26>&#34;-errorinfo&#34;</span>, <span style=color:#fe8019>-</span><span style=color:#d3869b>1</span>), <span style=color:#fe8019>&amp;</span>errorInfo) <span style=color:#fe8019>==</span> TCL_OK) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span><span style=color:#fabd2f>printf</span>(<span style=color:#b8bb26>&#34;Error info: %s</span><span style=color:#b8bb26>\n</span><span style=color:#b8bb26>&#34;</span>, <span style=color:#fabd2f>Tcl_GetString</span>(errorInfo));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>}
</span></span></code></pre></div></div></article></main><aside><div><div><h3>LATEST POSTS</h3></div><div><ul><li><a href=/posts/y2024q4-media-summary/>Y2024Q4 影视音总结</a></li><li><a href=/posts/tcl_c_api_usage_1/>Tcl C API 概览(一)</a></li><li><a href=/posts/push_back_emplace_back/>C++中的push_back与emplace_back</a></li><li><a href=/posts/y2024q3-media-summary/>Y2024Q3 影视音总结</a></li><li><a href=/posts/y2024q2-media-summary/>Y2024Q2 影视音总结</a></li></ul></div></div></aside><footer><p>&copy; 2024 <a href=https://lxulxu.github.io/><b>lxulxu's blog</b></a>.
<a href=https://github.com/lxulxu><b>Github</b></a>.
<a href=https://space.bilibili.com/7739434><b>Bilibili</b></a>.</p></footer></body></html>